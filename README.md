# Short Squeeze Detector (山寨幣軋空策略 Bot)

這個專案是一個以 Go 語言實作的自動化監控機器人。主要用於定時監控 Binance U本位永續合約上的指定山寨幣對，當發現市場可能出現「軋空 (Short Squeeze)」機會時，會透過 Telegram 自動發送警報通知使用者。

---

## 策略背景與邏輯推導

在加密貨幣市場中，當風險情緒升溫、流動性不足時，手握大量山寨幣現貨的「莊家」會面臨難以直接拋售套現的困境（直接賣出會導致價格崩盤）。為了尋找流動性，他們往往會利用**永續合約市場**來策劃「軋空」：

1. **誘導入局**：莊家透過少量資金拉抬現貨價格（推升 Index Price 與 Mark Price），引起合約市場的關注。
2. **吸引空頭**：散戶見到價格快速上漲，預期會回調，於是大量湧入永續合約建立空頭倉位（Short）。
3. **負費率紅利**：由於空頭過於擁擠，合約價格會低於現貨價格（產生負基差），這導致「資金費率 (Funding Rate)」轉為極端的負值。此時，作多的一方（包括早已佈局多單的莊家）能持續賺取空頭支付的資金費率。
4. **收割與退出**：隨著資金費率消耗以及價格緩步推升，當價格突破特定阻力位或到達空頭清算區間（爆倉價）時，空頭會被迫大量「買入平倉」。這瞬間產生的龐大買盤流動性，便成為莊家高位倒出手中籌碼的最佳時機。

這套策略的核心在於：**尋找空頭過度擁擠的標的，並透過指標提早發現莊家準備收割的訊號。**

---

## 核心監控指標

在軋空的醞釀與爆發過程中，市場數據會出現以下演變：
> **極端負費率** -> **持倉量 (OI) 異常激增** -> **價格突破阻力位** -> **帳戶多空比快速攀升 (空軍帳戶遭大量清算出場)** -> **數據回歸正常**

為了在爆發前夕捕捉訊號，本機器人重點監控以下兩個「前置指標」：

1. **極端資金費率 (Funding Rate)**
   - **意義**：當資金費率出現極端的負值（例如 `< -0.1%`），代表合約市場的空頭參與者過多，莊家對現貨控盤度高，且準備利用這股空頭力量。
2. **持倉量 (Open Interest, OI) 的短期激增**
   - **意義**：OI 快速攀升暗示有大量資金（可能是莊家）正在建立大規模的合約頭寸（吸收散戶的空單）。結合極端負費率來看，這通常是軋空即將啟動的強烈訊號。

---

## 系統實作機制

為了解決人工監控不易的問題，本專案提供以下的自動化功能：

### 1. 資料抓取與儲存
每隔一段固定時間（可透過 `config.yaml` 的 `interval` 設定），機器人會調用 Binance 官方 API，抓取指定交易對 (`symbols`) 的最新數據：
- **API 端點**：取得最新的「資金費率」(`/fapi/v1/premiumIndex`) 與「合約持倉量」(`/fapi/v1/openInterest`)。
- **本地紀錄**：為利於覆盤與後續數據分析，所有抓取到的歷史數據會自動被附加儲存於專案根目錄的 `data/<symbol>.csv`。

### 2. 警報觸發引擎
系統會在記憶體中保留最新的 10 筆市場數據，並透過策略引擎進行判定。當發現以下條件**同時成立**時，即視為觸發軋空警報：
- **條件 1**：當前的資金費率絕對值大於我們設定的閾值 (例如 `funding_rate_threshold: 0.001`，即 `0.1%`)。
- **條件 2**：短期的 OI 出現激增。即「最近 3 次的 OI 均值」除以「最近 10 次的 OI 總均值」，其比例大於我們設定的倍數 (例如 `oi_surge_ratio: 2.0`)。

### 3. Telegram 即時通知
一旦策略引擎捕捉到異常訊號，程式會立刻透過 Telegram Bot 將當下的：
* 幣對名稱
* 當前合約價格
* 資金費率百分比
* OI 激增的倍率狀況
整理成容易閱讀的 Markdown 格式推播至您的手機。提醒您搭配技術分析尋找適合的切入點或止盈止損位。

---

## Follow up

1. **引入大盤相對費率對比**：大盤崩跌時常引發全面性的負費率。未來應加入與 `BTCUSDT` 之資金費率的比對邏輯，若某山寨幣產生嚴重背離（例：大盤正常，該幣極度負值），才觸發警報，以排除系統性恐慌導致的誤報。
2. **將 OI 轉換為法幣名義價值 (Notional Value)**：目前持倉量是利用「合約的幣數」計算。若代幣暴跌，同樣價值的法幣能建立的合約幣量會自動放大，這會導致指標被動飆升引發誤判。未來應將計算改為 `OI * IndexPrice` （法幣對價），以真實反映資金進出的狀況。
